%% CRLB���棺�����ز��ۺϵĸ�Ƶ��״����Ƶ��״��Ƶ��CRLB������MSE�Ա�
%% �������
%% �������
M=64;%ofdm���Ÿ���
N=512;%���ز�����
c=3*1e8;%����
delta_f1=30*1e3;%��Ƶ���ز����
delta_f2=120*1e3;%��Ƶ���ز����
fc1=5.9*1e9;%��Ƶ�ز�Ƶ��
fc2=24*1e9;%��Ƶ�ز�Ƶ��
T1=1/delta_f1+ 5.85310734463*10^(-6);%��Ƶ�����ܳ���
T2=1/delta_f2+ 1.3*10^(-6);%��Ƶ�����ܳ���
K=4;%��״��Ƶ���
Q=4;%��״��Ƶ���
Nr=N/K;
MB=M/Q;
% %% ���㲻��SNR��CRLB
% crlb_R=3*c^2/(2*pi^2*delta_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1*(M-1)+T2*(M/4-1))^2)/((2*M^2-3*M+1)*T1^2+(M^2/2-3*M+4)*T2^2)));
% crlb_V=3*c^2/(2*pi^2*fc1^2*T1^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(delta_f2*(N-1)+delta_f1*(N/4-1))^2)/((2*N^2-3*N+1)*delta_f2^2+(N^2/2-3*N+4)*delta_f1^2)));
% %% ��SNR�ֱ�ת��Ϊ��׼����
% SNR=-30:1:-10;b
% snr=zeros(1,21);
% for i=1:21
%     snr(i)=10^(SNR(i)/10);
% end
% %% ����CRLB��MSE�Ա�ͼ
% figure(1)
% RMSE_benwen_R1=[412583.974,427977.64,126451.36,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625,0.03515625];
% semilogy(SNR,crlb_R./snr,'r');
% hold on
% semilogy(SNR,RMSE_benwen_R1,'b')
% xlabel('snr/dB')
% legend('CRLB of Range','MSE')
% 
% figure(2)
% RMSE_benwen_V=[4634.8864,2984.4369,4333.5889,2225.9524,2275.29,2574.5476,539.1684,472.1929,0.10086976,0.10086976,0.10086976,0.10086976,0.10086976,0.10086976,0.10086976,0.10086976,0.10086976,0.10086976,0.10086976,0.10086976,0.10086976];
% semilogy(SNR,crlb_V./snr,'r');
% hold on
% semilogy(SNR,RMSE_benwen_V,'b')
% xlabel('snr/dB')
% legend('CRLB of Velocity','MSE')
%% ���Ʋ�ͬ����ȣ���ͬ���ز�����µ�CRLB������ΪCRLB_R������ΪCRLB_V
% ��ͬ�����ز����
dt1_f1=30*1e3;
dt1_f2=120*1e3;
dt2_f1=40*1e3;
dt2_f2=160*1e3;
dt3_f1=50*1e3;
dt3_f2=200*1e3;
dt4_f1=60*1e3;
dt4_f2=240*1e3;
T1_1=1/dt1_f1+5.975141242935*10^(-6);
T2_1=1/dt1_f2+1.33*10^(-6);
T1_2=1/dt2_f1+5.975141242935*10^(-6);
T2_2=1/dt2_f2+1.33*10^(-6);
T1_3=1/dt3_f1+5.975141242935*10^(-6);
T2_3=1/dt3_f2+1.33*10^(-6);
T1_4=1/dt4_f1+5.975141242935*10^(-6);
T2_4=1/dt4_f2+1.33*10^(-6);
% ��ͬ�������(ת��Ϊ��׼���)
snr1=10^(-10/10); %-20dB
snr2=10^(-8/10); %-10dB
snr3=10^(-5/10); %0dB
snr4=10^(0/10); %10dB
% ��ͬ�����µ�CRLBֵ
 % ���ز�Ϊ��һ�飬����SNR
crlb_R_11=3*c^2/(2*pi^2*dt1_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_1*(M-1)+T2_1*(M/4-1))^2)/((2*M^2-3*M+1)*T1_1^2+(M^2/2-3*M+4)*T2_1^2)))/snr1;
crlb_V_11=3*c^2/(2*pi^2*fc1^2*T1_1^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt1_f2*(N-1)+dt1_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt1_f2^2+(N^2/2-3*N+4)*dt1_f1^2)))/snr1;
crlb_R_12=3*c^2/(2*pi^2*dt1_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_1*(M-1)+T2_1*(M/4-1))^2)/((2*M^2-3*M+1)*T1_1^2+(M^2/2-3*M+4)*T2_1^2)))/snr2;
crlb_V_12=3*c^2/(2*pi^2*fc1^2*T1_1^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt1_f2*(N-1)+dt1_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt1_f2^2+(N^2/2-3*N+4)*dt1_f1^2)))/snr2;
crlb_R_13=3*c^2/(2*pi^2*dt1_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_1*(M-1)+T2_1*(M/4-1))^2)/((2*M^2-3*M+1)*T1_1^2+(M^2/2-3*M+4)*T2_1^2)))/snr3;
crlb_V_13=3*c^2/(2*pi^2*fc1^2*T1_1^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt1_f2*(N-1)+dt1_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt1_f2^2+(N^2/2-3*N+4)*dt1_f1^2)))/snr3;
crlb_R_14=3*c^2/(2*pi^2*dt1_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_1*(M-1)+T2_1*(M/4-1))^2)/((2*M^2-3*M+1)*T1_1^2+(M^2/2-3*M+4)*T2_1^2)))/snr4;
crlb_V_14=3*c^2/(2*pi^2*fc1^2*T1_1^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt1_f2*(N-1)+dt1_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt1_f2^2+(N^2/2-3*N+4)*dt1_f1^2)))/snr4;
 % ���ز�Ϊ�ڶ��飬����SNR
crlb_R_21=3*c^2/(2*pi^2*dt2_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_2*(M-1)+T2_2*(M/4-1))^2)/((2*M^2-3*M+1)*T1_2^2+(M^2/2-3*M+4)*T2_2^2)))/snr1;
crlb_V_21=3*c^2/(2*pi^2*fc1^2*T1_2^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt2_f2*(N-1)+dt2_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt2_f2^2+(N^2/2-3*N+4)*dt2_f1^2)))/snr1;
crlb_R_22=3*c^2/(2*pi^2*dt2_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_2*(M-1)+T2_2*(M/4-1))^2)/((2*M^2-3*M+1)*T1_2^2+(M^2/2-3*M+4)*T2_2^2)))/snr2;
crlb_V_22=3*c^2/(2*pi^2*fc1^2*T1_2^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt2_f2*(N-1)+dt2_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt2_f2^2+(N^2/2-3*N+4)*dt2_f1^2)))/snr2;
crlb_R_23=3*c^2/(2*pi^2*dt2_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_2*(M-1)+T2_2*(M/4-1))^2)/((2*M^2-3*M+1)*T1_2^2+(M^2/2-3*M+4)*T2_2^2)))/snr3;
crlb_V_23=3*c^2/(2*pi^2*fc1^2*T1_2^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt2_f2*(N-1)+dt2_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt2_f2^2+(N^2/2-3*N+4)*dt2_f1^2)))/snr3;
crlb_R_24=3*c^2/(2*pi^2*dt2_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_2*(M-1)+T2_2*(M/4-1))^2)/((2*M^2-3*M+1)*T1_2^2+(M^2/2-3*M+4)*T2_2^2)))/snr4;
crlb_V_24=3*c^2/(2*pi^2*fc1^2*T1_2^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt2_f2*(N-1)+dt2_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt2_f2^2+(N^2/2-3*N+4)*dt2_f1^2)))/snr4;
 %���ز�Ϊ�����飬����SNR
crlb_R_31=3*c^2/(2*pi^2*dt3_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_3*(M-1)+T2_3*(M/4-1))^2)/((2*M^2-3*M+1)*T1_3^2+(M^2/2-3*M+4)*T2_3^2)))/snr1;
crlb_V_31=3*c^2/(2*pi^2*fc1^2*T1_3^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt3_f2*(N-1)+dt3_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt3_f2^2+(N^2/2-3*N+4)*dt3_f1^2)))/snr1;
crlb_R_32=3*c^2/(2*pi^2*dt3_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_3*(M-1)+T2_3*(M/4-1))^2)/((2*M^2-3*M+1)*T1_3^2+(M^2/2-3*M+4)*T2_3^2)))/snr2;
crlb_V_32=3*c^2/(2*pi^2*fc1^2*T1_3^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt3_f2*(N-1)+dt3_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt3_f2^2+(N^2/2-3*N+4)*dt3_f1^2)))/snr2;
crlb_R_33=3*c^2/(2*pi^2*dt3_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_3*(M-1)+T2_3*(M/4-1))^2)/((2*M^2-3*M+1)*T1_3^2+(M^2/2-3*M+4)*T2_3^2)))/snr3;
crlb_V_33=3*c^2/(2*pi^2*fc1^2*T1_3^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt3_f2*(N-1)+dt3_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt3_f2^2+(N^2/2-3*N+4)*dt3_f1^2)))/snr3;
crlb_R_34=3*c^2/(2*pi^2*dt3_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_3*(M-1)+T2_3*(M/4-1))^2)/((2*M^2-3*M+1)*T1_3^2+(M^2/2-3*M+4)*T2_3^2)))/snr4;
crlb_V_34=3*c^2/(2*pi^2*fc1^2*T1_3^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt3_f2*(N-1)+dt3_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt3_f2^2+(N^2/2-3*N+4)*dt3_f1^2)))/snr4; 
 %���ز�Ϊ�����飬����SNR
crlb_R_41=3*c^2/(2*pi^2*dt4_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_4*(M-1)+T2_4*(M/4-1))^2)/((2*M^2-3*M+1)*T1_4^2+(M^2/2-3*M+4)*T2_4^2)))/snr1;
crlb_V_41=3*c^2/(2*pi^2*fc1^2*T1_4^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt4_f2*(N-1)+dt4_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt4_f2^2+(N^2/2-3*N+4)*dt4_f1^2)))/snr1;
crlb_R_42=3*c^2/(2*pi^2*dt4_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_4*(M-1)+T2_4*(M/4-1))^2)/((2*M^2-3*M+1)*T1_4^2+(M^2/2-3*M+4)*T2_4^2)))/snr2;
crlb_V_42=3*c^2/(2*pi^2*fc1^2*T1_4^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt4_f2*(N-1)+dt4_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt4_f2^2+(N^2/2-3*N+4)*dt4_f1^2)))/snr2;
crlb_R_43=3*c^2/(2*pi^2*dt4_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_4*(M-1)+T2_4*(M/4-1))^2)/((2*M^2-3*M+1)*T1_4^2+(M^2/2-3*M+4)*T2_4^2)))/snr3;
crlb_V_43=3*c^2/(2*pi^2*fc1^2*T1_4^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt4_f2*(N-1)+dt4_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt4_f2^2+(N^2/2-3*N+4)*dt4_f1^2)))/snr3;
crlb_R_44=3*c^2/(2*pi^2*dt4_f2^2*(N^2-N)*M*(5*(2*N-1)-(9*(N-1)*(T1_4*(M-1)+T2_4*(M/4-1))^2)/((2*M^2-3*M+1)*T1_4^2+(M^2/2-3*M+4)*T2_4^2)))/snr4;
crlb_V_44=3*c^2/(2*pi^2*fc1^2*T1_4^2*(M^2-M)*N*(5*(2*M-1)-(9*(M-1)*(dt4_f2*(N-1)+dt4_f1*(N/4-1))^2)/((2*N^2-3*N+1)*dt4_f2^2+(N^2/2-3*N+4)*dt4_f1^2)))/snr4; 

%% ��ʼ��������ͼ
x1=[crlb_R_11,crlb_R_21,crlb_R_31,crlb_R_41];% ���snr1ʱ�����CRLBֵ
y1=[crlb_V_11,crlb_V_21,crlb_V_31,crlb_V_41];% ���snr1ʱ�ٶȵ�CRLBֵ
plot(x1,y1,'r');
hold on
x2=[crlb_R_12,crlb_R_22,crlb_R_32,crlb_R_42];% ���snr2ʱ�����CRLBֵ
y2=[crlb_V_12,crlb_V_22,crlb_V_32,crlb_V_42];% ���snr2ʱ�ٶȵ�CRLBֵ
plot(x2,y2,'b');
hold on
x3=[crlb_R_13,crlb_R_23,crlb_R_33,crlb_R_43];% ���snr3ʱ�����CRLBֵ
y3=[crlb_V_13,crlb_V_23,crlb_V_33,crlb_V_43];% ���snr3ʱ�ٶȵ�CRLBֵ
plot(x3,y3,'g');
hold on
x4=[crlb_R_14,crlb_R_24,crlb_R_34,crlb_R_44];% ���snr4ʱ�����CRLBֵ
y4=[crlb_V_14,crlb_V_24,crlb_V_34,crlb_V_44];% ���snr4ʱ�ٶȵ�CRLBֵ
plot(x4,y4,'p');
xlabel('CRLB of Range(m)')
ylabel('CRLB of Velocity(m/s)')
legend('SNR=-10dB','SNR=-8dB','SNR=-5dB','SNR=0dB')